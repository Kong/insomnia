name: Snapcraft Test

on:
  push:
    branches:
      - release/snap

env:
  GH_TOKEN: ${{ secrets.GH_TOKEN }}
  GITHUB_SHA: ${{ github.sha }}
  NPM_CONFIG_TARGET: 3.1.13
  NPM_CONFIG_DISTURL: https://electronjs.org/headers
  NPM_CONFIG_RUNTIME: electron

jobs:
  Core:
    runs-on: ubuntu-latest
    container: electronuserland/builder:latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-node@v1
        with:
          node-version: 10
      - run: apt-get update && apt-get install --yes libfontconfig1-dev
      - run: npm run bootstrap
      - run: npm run app-release
        env:
          SNAPCRAFT_LOGIN_FILE: ${{ secrets.SNAPCRAFT_LOGIN_FILE }}
          BUILD_TARGETS: AppImage,deb,tar.gz,rpm,snap
          GITHUB_REF: core@2020.2.2
  Designer:
    runs-on: ubuntu-latest
    container: electronuserland/builder:latest
    steps:
      - uses: actions/checkout@v1
      - run: apt-get update && apt-get install --yes libfontconfig1-dev
      - run: npm run bootstrap
      - run: npm run app-release
        env:
          NODE_VERSION: 10.20.1
          SNAPCRAFT_LOGIN_FILE: ${{ secrets.SNAPCRAFT_LOGIN_FILE }}
          BUILD_TARGETS: AppImage,deb,tar.gz,rpm,snap
          GITHUB_REF: designer@2020.2.2
